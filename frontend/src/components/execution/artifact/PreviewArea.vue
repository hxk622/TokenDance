<script setup lang="ts">
import { ref } from 'vue'
import CoworkerFileTree from '../workflow/CoworkerFileTree.vue'
import LiveDiff from './LiveDiff.vue'

interface Props {
  sessionId: string
  currentTab?: 'report' | 'ppt' | 'file-diff'
}

const props = withDefaults(defineProps<Props>(), {
  currentTab: 'report'
})

// Mock preview content
const previewContent = ref(`# AI Agent å¸‚åœºåˆ†ææŠ¥å‘Š

## æ‰§è¡Œæ‘˜è¦
æœ¬æŠ¥å‘Šåˆ†æäº†å½“å‰AI Agentå¸‚åœºçš„ä¸»è¦è¶‹åŠ¿å’Œç«äº‰æ ¼å±€...

## å¸‚åœºè§„æ¨¡
- 2024å¹´å…¨çƒå¸‚åœº: $120äº¿ç¾å…ƒ
- é¢„è®¡2026å¹´: $350äº¿ç¾å…ƒ
- CAGR: 45%

## ä¸»è¦ç«å“
1. **Manus** - æ²™ç®±æ‰§è¡Œ + è®¡åˆ’èƒŒè¯µ
2. **Coworker** - æœ¬åœ°æ–‡ä»¶æ·±åº¦æ“æ§
3. **GenSpark** - æ·±åº¦ç ”ç©¶å¼•æ“

## å·®å¼‚åŒ–æœºä¼š
- Vibe Workflowç†å¿µ
- ä¸‰æ–‡ä»¶å·¥ä½œæ³•
- å¤šæ¨¡æ€èƒ½åŠ›æ•´åˆ

---
*Generated by TokenDance AI Agent*
`)
</script>

<template>
  <div class="preview-area">
    <!-- Report Tab -->
    <div v-if="currentTab === 'report'" class="preview-content">
      <pre class="markdown-preview">{{ previewContent }}</pre>
      <div class="preview-actions">
        <button class="btn-action">ğŸ“¥ ä¸‹è½½</button>
        <button class="btn-action">ğŸ“‹ å¤åˆ¶</button>
        <button class="btn-action">ğŸ”„ åˆ·æ–°</button>
      </div>
    </div>

    <!-- PPT Tab (Phase3) -->
    <div v-else-if="currentTab === 'ppt'" class="preview-content">
      <div class="ppt-placeholder">
        <span class="placeholder-icon">ğŸ“Š</span>
        <p>PPTé¢„è§ˆåŠŸèƒ½å°†åœ¨Phase3å®ç°</p>
      </div>
    </div>

    <!-- File Diff Tab -->
    <div v-else-if="currentTab === 'file-diff'" class="file-diff-view">
      <div class="file-diff-layout">
        <div class="file-tree-panel">
          <CoworkerFileTree />
        </div>
        <div class="diff-panel">
          <LiveDiff />
        </div>
      </div>
    </div>
  </div>
</template>

<style scoped>
.preview-area {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  position: relative;
}

.preview-content {
  flex: 1;
  padding: 24px;
  overflow-y: auto;
  background: var(--bg-secondary, rgba(28, 28, 30, 0.9));
}

.preview-content::-webkit-scrollbar {
  width: 8px;
}

.preview-content::-webkit-scrollbar-track {
  background: rgba(255, 255, 255, 0.05);
}

.preview-content::-webkit-scrollbar-thumb {
  background: rgba(255, 255, 255, 0.2);
  border-radius: 4px;
}

.markdown-preview {
  color: var(--text-primary);
  font-size: 14px;
  line-height: 1.8;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  white-space: pre-wrap;
  word-wrap: break-word;
}

.preview-actions {
  position: absolute;
  top: 16px;
  right: 16px;
  display: flex;
  gap: 8px;
}

.btn-action {
  padding: 8px 12px;
  background: rgba(28, 28, 30, 0.9);
  border: 1px solid var(--divider-color);
  border-radius: 6px;
  color: var(--text-primary);
  cursor: pointer;
  font-size: 13px;
  backdrop-filter: blur(10px);
  transition: all 120ms ease-out;
}

.btn-action:hover {
  background: rgba(0, 217, 255, 0.2);
  border-color: var(--color-node-active);
}

/* PPT Placeholder */
.ppt-placeholder {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
  color: var(--text-secondary);
}

.placeholder-icon {
  font-size: 64px;
  margin-bottom: 16px;
  opacity: 0.5;
}

.ppt-placeholder p {
  margin: 0;
  font-size: 14px;
}

/* File Diff View */
.file-diff-view {
  flex: 1;
  display: flex;
  overflow: hidden;
}

.file-diff-layout {
  flex: 1;
  display: flex;
  gap: 1px;
  background: var(--divider-color);
}

.file-tree-panel {
  width: 280px;
  flex-shrink: 0;
  background: var(--bg-primary);
  overflow: hidden;
}

.diff-panel {
  flex: 1;
  background: var(--bg-primary);
  overflow: hidden;
}

:root {
  --bg-primary: rgba(18, 18, 18, 0.95);
  --bg-secondary: rgba(28, 28, 30, 0.9);
  --text-primary: #ffffff;
  --text-secondary: rgba(255, 255, 255, 0.6);
  --divider-color: rgba(255, 255, 255, 0.1);
  --color-node-active: #00D9FF;
}
</style>
